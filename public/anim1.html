<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Case of the Depressed Goldfish</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            font-family: Arial, sans-serif;
        }
        #animation-container {
            width: 100%;
            height: 100%;
            position: relative;
            overflow: hidden;
        }
        .scene {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            opacity: 0;
        }
        .character {
            position: absolute;
            font-size: 10vmin;
        }
        .speech-bubble {
            position: absolute;
            background-color: white;
            border-radius: 20px;
            padding: 10px;
            font-size: 3vmin;
            max-width: 40%;
            opacity: 0;
            z-index: 10;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .speech-bubble::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            border-width: 10px 10px 0;
            border-style: solid;
            border-color: white transparent;
            transform: translateX(-50%);
        }
        .narration {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            border-radius: 20px;
            padding: 10px;
            font-size: 3vmin;
            max-width: 80%;
            text-align: center;
            opacity: 0;
            z-index: 20;
        }
        #desk {
            width: 40%;
            height: 15%;
            background-color: #8B4513;
            position: absolute;
            bottom: 10%;
            left: 10%;
            border-radius: 10px 10px 0 0;
        }
        .bubble {
            position: absolute;
            background-color: rgba(255,255,255,0.5);
            border-radius: 50%;
            opacity: 0;
        }
        .office-item {
            position: absolute;
            font-size: 8vmin;
        }
        #books {
            top: 40%;
            right: 15%;
        }
        #coffee {
            bottom: 30%;
            left: 35%;
        }
        #phone {
            bottom: 25%;
            left: 55%;
        }
    </style>
</head>
<body>
    <div id="animation-container">
        <div id="office" class="scene">
            <svg width="100%" height="100%" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid slice">
                <defs>
                    <linearGradient id="wallGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                        <stop offset="0%" style="stop-color:#4B5320;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#2F4F4F;stop-opacity:1" />
                    </linearGradient>
                </defs>
                <rect width="100" height="100" fill="url(#wallGradient)"/>
                <rect x="10" y="65" width="40" height="15" fill="#8B4513" rx="2" ry="2"/>
                <rect x="12" y="63" width="36" height="2" fill="#A0522D" rx="1" ry="1"/>
                <rect x="75" y="10" width="15" height="25" fill="#D2B48C" stroke="#8B4513" stroke-width="1"/>
                <line x1="82.5" y1="10" x2="82.5" y2="35" stroke="#8B4513" stroke-width="0.5"/>
                <line x1="75" y1="22.5" x2="90" y2="22.5" stroke="#8B4513" stroke-width="0.5"/>
            </svg>
            <div id="detective-1" class="character" style="bottom: 25%; left: 15%;">üïµÔ∏è‚Äç‚ôÇÔ∏è</div>
            <div id="detective-speech-1" class="speech-bubble" style="bottom: 40%; left: 5%;"></div>
            <div id="books" class="office-item">üìö</div>
            <div id="coffee" class="office-item">‚òï</div>
            <div id="phone" class="office-item">üìû</div>
        </div>
        <div id="aquarium" class="scene">
            <svg width="100%" height="100%" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid slice">
                <defs>
                    <linearGradient id="waterGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                        <stop offset="0%" style="stop-color:#87CEEB;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#1E90FF;stop-opacity:1" />
                    </linearGradient>
                </defs>
                <rect width="100" height="100" fill="url(#waterGradient)"/>
                <circle id="fishbowl-svg" cx="50" cy="50" r="25" fill="none" stroke="#B8860B" stroke-width="2"/>
                <rect id="square-fishbowl-svg" x="25" y="25" width="50" height="50" fill="none" stroke="#B8860B" stroke-width="2" opacity="0"/>
                <path d="M10,80 Q50,70 90,80" fill="none" stroke="#228B22" stroke-width="1"/>
                <path d="M15,90 Q50,80 85,90" fill="none" stroke="#228B22" stroke-width="1.5"/>
            </svg>
            <div id="bubbles" class="character" style="top: 50%; left: 50%; transform: translate(-50%, -50%);">üê†</div>
            <div id="owner" class="character" style="bottom: 10%; right: 10%;">üë©</div>
            <div id="detective-2" class="character" style="bottom: 10%; left: 10%;">üïµÔ∏è‚Äç‚ôÇÔ∏è</div>
            <div id="owner-speech-1" class="speech-bubble" style="bottom: 25%; right: 5%;"></div>
            <div id="detective-speech-2" class="speech-bubble" style="bottom: 25%; left: 5%;"></div>
            <div id="bubbles-speech-1" class="speech-bubble" style="top: 30%; left: 50%; transform: translateX(-50%);"></div>
            <div id="detective-speech-3" class="speech-bubble" style="bottom: 25%; left: 5%;"></div>
            <div id="bubbles-speech-2" class="speech-bubble" style="top: 30%; left: 50%; transform: translateX(-50%);"></div>
            <div id="owner-speech-2" class="speech-bubble" style="bottom: 25%; right: 5%;"></div>
        </div>
        <div id="narration-1" class="narration"></div>
        <div id="narration-2" class="narration"></div>
        <div id="narration-3" class="narration"></div>
        <div id="narration-4" class="narration"></div>
    </div>

    <script>
        const tl = gsap.timeline();

        function showSpeech(id, text, duration = 2) {
            const element = document.getElementById(id);
            element.textContent = text;
            return gsap.timeline()
                .to(element, {duration: 0.5, opacity: 1, scale: 1, ease: "back.out(1.7)"})
                .to(element, {duration: 0.5, opacity: 0, scale: 0.8, delay: duration, ease: "power2.in"});
        }

        function showNarration(id, text, duration = 3) {
            const element = document.getElementById(id);
            element.textContent = text;
            return gsap.timeline()
                .to(element, {duration: 0.5, opacity: 1, y: 10, ease: "power2.out"})
                .to(element, {duration: 0.5, opacity: 0, y: -10, delay: duration, ease: "power2.in"});
        }

        function createBubbles(container, count) {
            for (let i = 0; i < count; i++) {
                const bubble = document.createElement('div');
                bubble.className = 'bubble';
                bubble.style.width = bubble.style.height = `${Math.random() * 2 + 0.5}vmin`;
                bubble.style.left = `${Math.random() * 100}%`;
                bubble.style.top = `${Math.random() * 100}%`;
                container.appendChild(bubble);

                gsap.to(bubble, {
                    y: `-=${Math.random() * 20 + 10}vmin`,
                    x: `+=${Math.random() * 10 - 5}vmin`,
                    opacity: 1,
                    duration: Math.random() * 2 + 1,
                    repeat: -1,
                    delay: Math.random() * 2,
                    ease: "power1.inOut",
                    yoyo: true
                });
            }
        }

        // Create bubbles in the aquarium
        createBubbles(document.querySelector("#aquarium"), 20);

        // Scene 1: The Call
        tl.to("#office", {duration: 1, opacity: 1})
          .add(showNarration("narration-1", "In the bustling city of Aquapolis, Detective Finn receives an unusual call..."))
          .from("#detective-1", {duration: 1, x: "-20vw", opacity: 0})
          .from("#books, #coffee, #phone", {duration: 0.5, opacity: 0, scale: 0, stagger: 0.2, ease: "back.out(1.7)"})
          .to("#phone", {duration: 0.1, y: "-1vmin", repeat: 5, yoyo: true})
          .add(showSpeech("detective-speech-1", "Detective Finn here. What's the catch of the day?"))
          .to("#detective-1", {duration: 0.5, rotate: 10, yoyo: true, repeat: 1})
          .to("#office", {duration: 1, opacity: 0, delay: 1});

        // Scene 2: The Crime Scene
        tl.to("#aquarium", {duration: 1, opacity: 1})
          .add(showNarration("narration-2", "At the luxurious Bubble Palace, Detective Finn encounters a most peculiar case..."))
          .from("#fishbowl-svg", {duration: 1, scale: 0, transformOrigin: "center", ease: "elastic.out(1, 0.5)"})
          .from("#bubbles", {duration: 1, opacity: 0, scale: 0, ease: "back.out(1.7)"})
          .from("#owner", {duration: 1, x: "20vw", opacity: 0})
          .add(showSpeech("owner-speech-1", "Detective, look at poor Bubbles! He's so depressed!"))
          .to("#bubbles", {duration: 2, rotation: 10, yoyo: true, repeat: -1, ease: "sine.inOut"})
          .from("#detective-2", {duration: 1, x: "-20vw", y: "20vh", scale: 0.7, opacity: 0})
          .to("#detective-2", {duration: 2, x: "+=10vw", y: "+=10vh", ease: "power2.inOut"})
          .add(showSpeech("detective-speech-2", "Hmm... How long has the suspect... I mean, your fish been like this?"));

        // Scene 3: The Solution
        tl.add(showNarration("narration-3", "As Detective Finn investigates, he uncovers a surprising truth..."))
          .add(showSpeech("bubbles-speech-1", "I'm just tired, Detective. Tired of swimming in endless circles."))
          .to("#detective-2", {duration: 1, scale: 1.2, ease: "back.out(1.7)"})
          .add(showSpeech("detective-speech-3", "Great Scott! I've solved it!"))
          .to("#square-fishbowl-svg", {duration: 1, opacity: 1, scale: 1.1, transformOrigin: "center", ease: "elastic.out(1, 0.5)"})
          .to("#fishbowl-svg", {duration: 1, opacity: 0, scale: 0.9, transformOrigin: "center", ease: "power2.in"}, "<")
          .to("#bubbles", {duration: 1, scale: 1.2, ease: "back.out(1.7)"})
          .to("#bubbles", {
              duration: 8,
              repeat: -1,
              ease: "none",
              motionPath: {
                  path: [
                      {x: "-10vw", y: "-10vh"},
                      {x: "10vw", y: "-10vh"},
                      {x: "10vw", y: "10vh"},
                      {x: "-10vw", y: "10vh"},
                      {x: "-10vw", y: "-10vh"}
                  ],
                  curviness: 0,
                  autoRotate: true
              }
          })
          .add(showSpeech("bubbles-speech-2", "Wee! Look at me go! I've never felt so angle-ic in my life!"))
          .to("#owner", {duration: 0.5, y: "-4vmin", repeat: 1, yoyo: true})
          .add(showSpeech("owner-speech-2", "You've worked miracles, Detective!"))
          .to("#detective-2", {duration: 2, x: "80vw", y: "40vh", scale: 0.5, opacity: 0, ease: "power2.in"})
          .add(showNarration("narration-4", "And so, Detective Finn swam away from another successful case, leaving behind a very happy square fish."))
          .to("#aquarium", {duration: 1, opacity: 0, delay: 1});

        // Add interactivity
        document.querySelector("#animation-container").addEventListener("click", () => {
            tl.paused() ? tl.play() : tl.pause();
        });

        // Make the animation responsive
        function resizeAnimation() {
            const vw = window.innerWidth / 100;
            const vh = window.innerHeight / 100;

            // Adjust font sizes
            document.querySelectorAll('.character').forEach(char => {
                char.style.fontSize = `${10 * Math.min(vw, vh)}px`;
            });

            document.querySelectorAll('.office-item').forEach(item => {
                item.style.fontSize = `${8 * Math.min(vw, vh)}px`;
            });

            document.querySelectorAll('.speech-bubble').forEach(bubble => {
                bubble.style.fontSize = `${3 * Math.min(vw, vh)}px`;
            });

            document.querySelectorAll('.narration').forEach(narr => {
                narr.style.fontSize = `${3 * Math.min(vw, vh)}px`;
            });

            // Adjust positions
            const detective1 = document.getElementById('detective-1');
            detective1.style.bottom = '25%';
            detective1.style.left = '15%';

            const coffee = document.getElementById('coffee');
            coffee.style.bottom = '30%';
            coffee.style.left = '35%';

            const phone = document.getElementById('phone');
            phone.style.bottom = '25%';
            phone.style.left = '55%';

            // Recalculate bubble sizes and positions
            document.querySelectorAll('.bubble').forEach(bubble => {
                bubble.style.width = bubble.style.height = `${(Math.random() * 2 + 0.5) * Math.min(vw, vh)}px`;
            });
        }

        // Call resizeAnimation on window resize
        window.addEventListener('resize', resizeAnimation);

        // Initial call to set up the animation
        resizeAnimation();

        // Restart the animation when it completes
        tl.eventCallback("onComplete", () => {
            tl.restart();
        });
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Case of the Depressed Goldfish</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            font-family: Arial, sans-serif;
        }
        #animation-container {
            width: 100%;
            height: 100%;
            position: relative;
            overflow: hidden;
        }
        .scene {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            opacity: 0;
        }
        .character {
            position: absolute;
            font-size: 48px;
        }
        .speech-bubble {
            position: absolute;
            background-color: white;
            border-radius: 20px;
            padding: 10px;
            font-size: 16px;
            max-width: 200px;
            opacity: 0;
            z-index: 10;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .speech-bubble::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            border-width: 10px 10px 0;
            border-style: solid;
            border-color: white transparent;
            transform: translateX(-50%);
        }
        .narration {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            border-radius: 20px;
            padding: 10px;
            font-size: 16px;
            max-width: 280px;
            text-align: center;
            opacity: 0;
            z-index: 20;
        }
        #office, #aquarium {
            width: 100%;
            height: 100%;
        }
        #fishbowl, #square-fishbowl {
            width: 200px;
            height: 200px;
            border: 10px solid #B8860B;
            background: rgba(135, 206, 235, 0.6);
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        #fishbowl {
            border-radius: 50%;
        }
        #square-fishbowl {
            opacity: 0;
        }
        .bubble {
            position: absolute;
            background-color: rgba(255,255,255,0.5);
            border-radius: 50%;
            opacity: 0;
        }
    </style>
</head>
<body>
    <div id="animation-container">
        <div id="office" class="scene">
            <svg width="100%" height="100%" viewBox="0 0 1000 1000" preserveAspectRatio="xMidYMid slice">
                <defs>
                    <linearGradient id="officeWall" x1="0%" y1="0%" x2="0%" y2="100%">
                        <stop offset="0%" style="stop-color:#4B5320;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#2F4F4F;stop-opacity:1" />
                    </linearGradient>
                </defs>
                <rect width="1000" height="1000" fill="url(#officeWall)" />
                <rect x="100" y="700" width="300" height="150" fill="#8B4513" rx="10" ry="10" />
                <rect x="150" y="50" width="200" height="300" fill="#A0522D" stroke="#8B4513" stroke-width="10" />
                <circle cx="250" cy="200" r="50" fill="#FFD700" />
                <rect x="700" y="100" width="200" height="300" fill="#A9A9A9" />
                <rect x="725" y="125" width="150" height="50" fill="#FFFFFF" />
                <rect x="725" y="200" width="150" height="50" fill="#FFFFFF" />
                <rect x="725" y="275" width="150" height="50" fill="#FFFFFF" />
            </svg>
            <div id="detective-1" class="character" style="bottom: 120px; left: 70px;">üïµÔ∏è‚Äç‚ôÇÔ∏è</div>
            <div id="phone" class="character" style="bottom: 290px; left: 180px;">üìû</div>
            <div id="detective-speech-1" class="speech-bubble" style="bottom: 180px; left: 20px;"></div>
        </div>
        <div id="aquarium" class="scene">
            <svg width="100%" height="100%" viewBox="0 0 1000 1000" preserveAspectRatio="xMidYMid slice">
                <defs>
                    <linearGradient id="aquariumBg" x1="0%" y1="0%" x2="0%" y2="100%">
                        <stop offset="0%" style="stop-color:#87CEEB;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#1E90FF;stop-opacity:1" />
                    </linearGradient>
                </defs>
                <rect width="1000" height="1000" fill="url(#aquariumBg)" />
                <path d="M0 800 Q 250 700 500 800 T 1000 800 L 1000 1000 L 0 1000 Z" fill="#228B22" />
                <circle cx="100" cy="100" r="50" fill="#FFD700" />
                <path d="M50 950 C 200 850, 300 900, 400 850 S 550 800, 650 850 S 800 900, 950 850" stroke="#8B4513" stroke-width="10" fill="none" />
            </svg>
            <div id="fishbowl"></div>
            <div id="square-fishbowl"></div>
            <div id="bubbles" class="character" style="top: 50%; left: 50%; transform: translate(-50%, -50%);">üê†</div>
            <div id="owner" class="character" style="bottom: 50px; right: 50px;">üë©</div>
            <div id="detective-2" class="character" style="bottom: 50px; left: 50px;">üïµÔ∏è‚Äç‚ôÇÔ∏è</div>
            <div id="owner-speech-1" class="speech-bubble" style="bottom: 120px; right: 20px;"></div>
            <div id="detective-speech-2" class="speech-bubble" style="bottom: 120px; left: 20px;"></div>
            <div id="bubbles-speech-1" class="speech-bubble" style="top: 30%; left: 50%; transform: translateX(-50%);"></div>
            <div id="detective-speech-3" class="speech-bubble" style="bottom: 120px; left: 20px;"></div>
            <div id="bubbles-speech-2" class="speech-bubble" style="top: 30%; left: 50%; transform: translateX(-50%);"></div>
            <div id="owner-speech-2" class="speech-bubble" style="bottom: 120px; right: 20px;"></div>
        </div>
        <div id="narration-1" class="narration"></div>
        <div id="narration-2" class="narration"></div>
        <div id="narration-3" class="narration"></div>
        <div id="narration-4" class="narration"></div>
    </div>

    <script>
        const tl = gsap.timeline();

        function showSpeech(id, text, duration = 1) {
            const element = document.getElementById(id);
            element.textContent = text;
            return gsap.timeline()
                .to(element, {duration: 0.3, opacity: 1, scale: 1, ease: "back.out(1.7)"})
                .to(element, {duration: 0.3, opacity: 0, scale: 0.8, delay: duration, ease: "power2.in"});
        }

        function showNarration(id, text, duration = 2) {
            const element = document.getElementById(id);
            element.textContent = text;
            return gsap.timeline()
                .to(element, {duration: 0.3, opacity: 1, y: 10, ease: "power2.out"})
                .to(element, {duration: 0.3, opacity: 0, y: -10, delay: duration, ease: "power2.in"});
        }

        function createBubbles(container, count) {
            for (let i = 0; i < count; i++) {
                const bubble = document.createElement('div');
                bubble.className = 'bubble';
                bubble.style.width = bubble.style.height = `${Math.random() * 20 + 5}px`;
                bubble.style.left = `${Math.random() * 100}%`;
                bubble.style.top = `${Math.random() * 100}%`;
                container.appendChild(bubble);

                gsap.to(bubble, {
                    y: `-=${Math.random() * 100 + 50}`,
                    x: `+=${Math.random() * 50 - 25}`,
                    opacity: 1,
                    duration: Math.random() * 2 + 1,
                    repeat: -1,
                    delay: Math.random() * 2,
                    ease: "power1.inOut",
                    yoyo: true
                });
            }
        }

        // Create bubbles in the fishbowl
        createBubbles(document.getElementById('fishbowl'), 10);
        createBubbles(document.getElementById('square-fishbowl'), 10);

        // Scene 1: The Call
        tl.to("#office", {duration: 1, opacity: 1})
          .add(showNarration("narration-1", "In the bustling city of Aquapolis, Detective Finn receives an unusual call..."))
          .from("#detective-1", {duration: 1, x: -100, opacity: 0})
          .from("#phone", {duration: 0.5, y: -50, opacity: 0})
          .to("#phone", {duration: 0.1, y: -5, repeat: 5, yoyo: true})
          .add(showSpeech("detective-speech-1", "Detective Finn here. What's the catch of the day?"))
          .to("#detective-1", {duration: 0.5, rotate: 10, yoyo: true, repeat: 1})
          .to("#office", {duration: 1, opacity: 0, delay: 1});

        // Scene 2: The Crime Scene
        tl.to("#aquarium", {duration: 1, opacity: 1})
          .add(showNarration("narration-2", "At the luxurious Bubble Palace, Detective Finn encounters a most peculiar case..."))
          .from("#fishbowl", {duration: 1, scale: 0, ease: "elastic.out(1, 0.5)"})
          .from("#bubbles", {duration: 1, opacity: 0, scale: 0, ease: "back.out(1.7)"})
          .from("#owner", {duration: 1, x: 100, opacity: 0})
          .add(showSpeech("owner-speech-1", "Detective, look at poor Bubbles! He's so depressed!"))
          .to("#bubbles", {duration: 2, rotation: 10, yoyo: true, repeat: -1, ease: "sine.inOut"})
          .from("#detective-2", {duration: 1, x: -100, y: 100, scale: 0.7, opacity: 0})
          .to("#detective-2", {duration: 2, x: "+=50", y: "+=50", ease: "power2.inOut"})
          .add(showSpeech("detective-speech-2", "Hmm... How long has the suspect... I mean, your fish been like this?"));

        // Scene 3: The Solution
        tl.add(showNarration("narration-3", "As Detective Finn investigates, he uncovers a surprising truth..."))
          .add(showSpeech("bubbles-speech-1", "I'm just tired, Detective. Tired of swimming in endless circles."))
          .to("#detective-2", {duration: 1, scale: 1.2, ease: "back.out(1.7)"})
          .add(showSpeech("detective-speech-3", "Great Scott! I've solved it!"))
          .to("#square-fishbowl", {duration: 1, opacity: 1, scale: 1.1, ease: "elastic.out(1, 0.5)"})
          .to("#fishbowl", {duration: 1, opacity: 0, scale: 0.9, ease: "power2.in"}, "<")
          .to("#bubbles", {duration: 1, scale: 1.2, ease: "back.out(1.7)"})
          .to("#bubbles", {
              duration: 4,
              repeat: -1,
              ease: "none",
              keyframes: [
                  {x: -50, y: -50, rotation: 0},
                  {x: 50, y: 50, rotation: 180},
                  {x: -50, y: 50, rotation: 270},
                  {x: 50, y: -50, rotation: 360}
              ]
          })
          .add(showSpeech("bubbles-speech-2", "Wee! Look at me go! I've never felt so angle-ic in my life!"))
          .to("#owner", {duration: 0.5, y: -20, repeat: 1, yoyo: true})
          .add(showSpeech("owner-speech-2", "You've worked miracles, Detective!"))
          .to("#detective-2", {duration: 2, x: 400, y: 200, scale: 0.5, opacity: 0, ease: "power2.in"})
          .add(showNarration("narration-4", "And so, Detective Finn solved another case, proving that sometimes, all we need is a change of perspective."));

        // Speed up the entire animation by 30%
        tl.timeScale(1.3);

        // Add interactivity
        document.querySelector("#animation-container").addEventListener("click", () => {
            tl.paused() ? tl.play() : tl.pause();
        });
    </script>
</body>

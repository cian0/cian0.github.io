(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[468],{5069:function(t,e,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/compact-music-player",function(){return r(4475)}])},4475:function(t,e,r){"use strict";r.r(e),r.d(e,{default:function(){return p}});var n=r(5893),s=r(7294),a=r(9008),o=r.n(a),c=r(347),i=r(698),l=r.n(i),u=()=>{let[t,e]=(0,s.useState)(null),[r,a]=(0,s.useState)([]),[o,i]=(0,s.useState)(!1),[u,p]=(0,s.useState)(!1),m=(0,s.useRef)(null),d=(0,s.useRef)(null),f=(0,s.useRef)(null),h=(0,s.useRef)(null),g=(0,s.useRef)(null),y=(0,s.useRef)(null),b=(0,s.useRef)(null),_=(0,s.useRef)(null),v=(0,s.useRef)(null),C=(0,s.useCallback)(t=>{console.log(t),v.current&&(v.current.innerHTML+=t+"<br>",v.current.scrollTop=v.current.scrollHeight)},[]),N=(0,s.useCallback)(t=>{C("Starting to parse score");let e=t.trim().split("\n");C("Score split into ".concat(e.length," lines"));let[r,n]=e[0].split(";");C("Parsed tempo: ".concat(r,", time signature: ").concat(n));let s=[];for(let t=1;t<e.length;t++)if(e[t].startsWith("T:")){C("Parsing track line: ".concat(e[t]));let[r,...n]=e[t].split(";"),a=r.substring(2);C("Parsed name: ".concat(a));let o=n.shift();for(;o.split("{").length!==o.split("}").length&&n.length;)o+=";"+n.shift();C("Parsed instrumentInfo: ".concat(o));let[c,i]=P(o);C("Parsed instrument type: ".concat(c)),C("Parsed instrument options: ".concat(JSON.stringify(i)));let l=[],u=0;n.forEach(t=>{t.includes("{")?(C("Parsing effect: ".concat(t)),l.push(S(t))):(u=parseFloat(t),C("Parsed volume: ".concat(u)))}),s.push({name:a,instrument:{type:c,options:i},effects:l,volume:u,notes:[]}),C("Added track: ".concat(JSON.stringify(s[s.length-1])))}else if(e[t].startsWith("N:")){C("Parsing note line: ".concat(e[t]));let r=e[t].substring(2).split(";");C("Split into ".concat(r.length," notes")),r.forEach(t=>{let[e,r,n]=t.split(","),[a,o]=n.split(":").map(Number),c="".concat(a,":").concat(o);C("Parsed note - pitch: ".concat(e,", duration: ").concat(r,", time: ").concat(c)),s[s.length-1].notes.push({pitch:e,duration:r,time:c})})}return C("Finished parsing score. Total tracks: ".concat(s.length)),{tempo:parseInt(r),timeSignature:n.split("/").map(Number),tracks:s}},[C]),P=(0,s.useCallback)(t=>{C("Parsing instrument: ".concat(t));let[e,...r]=t.split("{");C("Instrument type: ".concat(e.trim()));let n=r.join("{").slice(0,-1);if(C("Instrument options string: ".concat(n)),"Sampler"===e.trim()){C("Parsing Sampler instrument");let t={};return n.split("|").forEach(e=>{let[r,n]=e.split(":");t[r.trim()]=n.trim(),C("Added sample mapping: ".concat(r.trim()," -> ").concat(n.trim()))}),C("Completed Sampler parsing: ".concat(JSON.stringify(t))),["Sampler",t]}let s={};return n.split(";").forEach(t=>{let[e,r]=t.split(":");"envelope"===e?s.envelope={attack:parseFloat(r.split(",")[0]),decay:parseFloat(r.split(",")[1]),sustain:parseFloat(r.split(",")[2]),release:parseFloat(r.split(",")[3])}:s[e]=r}),C("Completed instrument parsing: ".concat(JSON.stringify(s))),[e.trim(),s]},[C]),S=(0,s.useCallback)(t=>{C("Parsing effect: ".concat(t));let[e,r]=t.split("{"),n={};return r.slice(0,-1).split(",").forEach((t,e)=>{let r=["delayTime","feedback","wet"][e];n[r]=t.includes("n")?t:Number(t),C("Parsed effect option ".concat(r,": ").concat(n[r]))}),C("Completed effect parsing: ".concat(e.trim()," ").concat(JSON.stringify(n))),{type:e.trim(),options:n}},[C]),k=t=>{C("Initializing player with score:"),C(JSON.stringify(t,null,2)),c.Transport.cancel(),console.log("parsedScore.tracks"),console.log(t.tracks);let e=t.tracks.map((t,e)=>{C("Initializing track: ".concat(t.name)),C("Instrument type: ".concat(t.instrument.type)),C("Instrument options: ".concat(JSON.stringify(t.instrument.options)));let r=[],n=()=>{try{let e;if(C("Creating instrument for track: ".concat(t.name)),C("Instrument type: ".concat(t.instrument.type)),C("Instrument options: ".concat(JSON.stringify(t.instrument.options))),"Sampler"===t.instrument.type?(C("Creating Sampler instrument"),e=new c.Sampler({urls:t.instrument.options,baseUrl:""}).toDestination()):(C("Creating ".concat(t.instrument.type," instrument")),e=new c[t.instrument.type](t.instrument.options).toDestination()),e.volume.value=t.volume,C("Set instrument volume to ".concat(t.volume)),t.effects&&t.effects.length>0){C("Applying ".concat(t.effects.length," effects to the instrument"));let r=t.effects.map(t=>(C("Creating effect: ".concat(t.type)),new c[t.type](t.options)));e.chain(...r,c.Destination)}return C("Instrument created successfully"),e}catch(e){return console.error("Error creating instrument for track ".concat(t.name,":"),e),C("Failed to create instrument for track ".concat(t.name,". Error: ").concat(e.message)),C("Using default Synth as fallback"),new c.Synth().toDestination()}};return r.push(n()),{instruments:r,name:t.name,createInstrument:n,color:w(),index:e}});c.Transport.timeSignature=t.timeSignature,c.Transport.bpm.value=t.tempo,C("Set tempo to ".concat(t.tempo," BPM and time signature to ").concat(t.timeSignature));let r=x(t);c.Transport.loop=u,c.Transport.loopEnd=r,C("Total duration: ".concat(r)),j(e,t),M(e,t),a(e),f.current.disabled=!1,h.current.disabled=!1,g.current.disabled=!1,y.current.disabled=!1},x=()=>{},j=()=>{},T=()=>{},w=()=>"hsl(".concat(360*Math.random(),", 70%, 60%)"),E=()=>{},M=()=>{};(0,s.useEffect)(()=>(T(),window.addEventListener("resize",T),()=>{window.removeEventListener("resize",T)}),[]);let z=async()=>{C("Play button clicked"),await c.start(),C("Tone.js started"),c.Transport.start(),C("Transport started"),i(!0),E(),C("Visualizer started")};return(0,n.jsxs)("div",{className:l()["retro-container"],children:[(0,n.jsx)("h1",{className:l()["retro-header"],children:"\uD83C\uDFB5 Compact Music Player \uD83C\uDFB6"}),(0,n.jsxs)("div",{className:l()["retro-panel"],children:[(0,n.jsx)("textarea",{ref:m,rows:"10",className:l()["retro-textarea"],placeholder:"Enter your score here..."}),(0,n.jsxs)("div",{className:l()["retro-controls"],children:[(0,n.jsx)("button",{ref:d,className:l()["retro-button"],onClick:()=>{d.current&&(d.current.onclick=()=>{let t=m.current.value;try{let r=N(t);e(r),k(r)}catch(t){console.error("Error parsing score:",t),alert("Invalid score format. Please check your input.")}})},children:"Parse Score"}),(0,n.jsx)("button",{ref:f,className:l()["retro-button"],onClick:z,disabled:!t||o,children:"Play"}),(0,n.jsx)("button",{ref:h,className:l()["retro-button"],onClick:()=>{C("Stop button clicked"),c.Transport.stop(),i(!1),C("Playback stopped")},disabled:!t||!o,children:"Stop"}),(0,n.jsx)("button",{ref:g,className:l()["retro-button"],onClick:()=>{C("Rewind button clicked"),c.Transport.position=0,C("Transport position reset to 0")},disabled:!t,children:"Rewind"}),(0,n.jsxs)("button",{ref:y,className:l()["retro-button"],onClick:()=>{let t=!u;p(t),c.Transport.loop=t,C("Looping ".concat(t?"enabled":"disabled"))},disabled:!t,children:["Loop: ",u?"On":"Off"]})]}),(0,n.jsxs)("div",{className:l()["retro-visualizer-container"],children:[(0,n.jsx)("canvas",{ref:b,className:l()["retro-visualizer"]}),(0,n.jsx)("canvas",{ref:_,className:l()["retro-static-visualizer"]})]})]}),(0,n.jsx)("div",{ref:v,className:l()["retro-debug"]})]})},p=()=>(0,n.jsxs)("div",{className:"retro-container",children:[(0,n.jsx)(o(),{children:(0,n.jsx)("title",{children:"Compact Music Player"})}),(0,n.jsxs)("div",{className:"retro-post",children:[(0,n.jsx)("div",{className:"retro-header",children:"\uD83C\uDFB5 Compact Music Player \uD83C\uDFB6"}),(0,n.jsxs)("div",{className:"retro-section",children:[(0,n.jsx)("p",{className:"retro-text",children:"Welcome to the Compact Music Player!"}),(0,n.jsx)("p",{className:"retro-text",children:"Use this player to visualize and play your music scores."})]}),(0,n.jsx)("div",{className:"retro-section",children:(0,n.jsx)(u,{})})]})]})},698:function(t){t.exports={"retro-container":"CompactMusicPlayer_retro-container__M9nT7","retro-header":"CompactMusicPlayer_retro-header__XmvcK","retro-panel":"CompactMusicPlayer_retro-panel__xWk8E","retro-textarea":"CompactMusicPlayer_retro-textarea__CKnqr","retro-controls":"CompactMusicPlayer_retro-controls__QV0Ri","retro-button":"CompactMusicPlayer_retro-button__RiHX8","retro-visualizer-container":"CompactMusicPlayer_retro-visualizer-container__v8SvG","retro-visualizer":"CompactMusicPlayer_retro-visualizer__zCaRj","retro-static-visualizer":"CompactMusicPlayer_retro-static-visualizer__O8QSM","retro-debug":"CompactMusicPlayer_retro-debug__UVGyn"}}},function(t){t.O(0,[119,888,774,179],function(){return t(t.s=5069)}),_N_E=t.O()}]);